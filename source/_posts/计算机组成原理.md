---
title: 计算机组成原理笔记
categories: learning-notes
excerpt: 如题，计算机组成原理笔记
hide: true
tag: markdown
---
{% note warning %}
{% endnote %} 
冯诺依曼计算机结构：存储器，控制器，运算器，输入设备，输出设备（I/O）
特点：存储程序，二进制

指令是计算机运行的最小功能单元

层次结构：
- 高级语言层
- 汇编语言层
- 操作系统层
- 指令系统层
- 微体系结构层
- 数字逻辑层

指令的功能：
- 数据运算
- 数据传输
- 输入/出
- 控制
- 其他（停机，开/关中断

计算机性能：
- 吞吐率：在单位时间内完成的工作量
- 响应时间：从作业提交开始到作业完成所花费的时间（包含CPU执行时间，磁盘访问，存储器访问，输入输出等所需时间）
- 计算机性能评价主要考虑CPU性能（与系统性能有别）

CPU性能：
- **时钟周期**：用于同步的时钟定时信号，即CPU主脉冲信号宽度
- **时钟频率**：CPU时钟周期的倒数
- **CPI**（cycles per instruction）：执行指令所需的时钟周期数
- 时钟周期，CPI，指令条数三个因素相互制约
- CPU执行时间=程序所含时钟周期数x时钟周期
- 程序总时钟周期数=CPIx程序所含指令条数
- 程序总时钟周期数=$\Sigma_{i=1}^{n}(CPI_{i}×C_{i})$

指令字长：指令字中二进制代码的位数

指令格式：
- 组成：操作码，操作数地址

字符集编码：
- ASCII：一个字节
- UNICODE：16位表示一个字符
- UTF8：变长字符编码

原码，反码，补码：
- 正数三者相同
- 负数
  - 原码：符号位||数的绝对值（符号位为1表示负数，后同）
  - 反码：符号位||绝对值按位取反
  - 补码：反码+1
- 原码和反码存在+0,-0，补码中只有一个0，补码比其余两者多一个数

移码：用于浮点数的阶码中，只用于表示定点整数。在原值的基础上加一个正的常数，将负数统一转为正数，一般是加上 $2^{n-1}$


```C++
#include<bits/stdc++.h> 
using namespace std;

int main()
{
  int a=INT_MAX;
  cout<<a<<endl;//      0111,1111,1111,1111,1111,1111,1111,1111，补码
  cout<<a+1<<endl;//    1000,0000,0000,0000,0000,0000,0000,0000，在补码中该数字表示-2147483648，不存在原码和反码
  cout<<-a<<endl;//     1000,0000,0000,0000,0000,0000,0000,0001
  for(int i=0;i<32;i++){
    if(i%4==0&&i!=0){
      cout<<' ';
    }
    cout<<(((-a)>>i)&1);
  }
}
```

定点数运算：
- 加法（减法可转为加法）溢出判断
  - 符号位的进位和数值最高位的进位不同，溢出
  - 两个加数符号位与和的符号位不同，溢出
- 乘法：布斯算法

大小端：
- 大端：数据低位存在内存的高位
- 小端：数据低位存在内存的低位
- 32位整数 $(12345678)_{16}$

|内存地址|4000|4001|4002|4003|
|--|--|--|--|--|
|大端存放数据|12|34|56|78|
|小端存放数据|78|56|34|12|


检错纠错码：
- 码距：任意两个合法码之间有几个二进制位不同
- 奇偶校验码：并行数据传输，可以检错
  - 偶校验：在k位码字中增加一位校验位，k+1位码字中取值为1的位数为偶数校验位为1
  - 奇校验：在k位码字中增加一位校验位，k+1位码字中取值为1的位数为奇数校验位为1
- 海明校验码：并行数据传输，可以检错纠错
  - 为k个数据位，设立r个校验位，使k+r位的码字能够发现并改正k+r中的任何一位，发现k+r中的任何两位同时出错（无法改正）
    - 满足 $2^{r}>=k+r+1$ 可以纠正一位
    - 满足 $2^{r-1}>=k+r$ 可以检错两位（包含纠错1位）
  - 实现：P表示校验码，D表示数据位，将P1,P2,P3...依次安排在2的幂次方位上，其余顺次放D1,D2,D3等，如
    ```
    P1 P2 D1 P3 D2 D3 P4
    1  2  3  4  5  6  
    3=1+2
    5=1+4
    6=2+4
    故P1对D1和D2校验；P2对D1和D3校验；P3对D2和D3校验
    编码时：
      P1=D1^D2, P2=D1^D3, P3=D2^D3
      P4是总校验位, P4=D1^D2^D3^P1^P2^P3
    译码时（给定海明码时计算以下内容）：
      S1=P1^D1^D2
      S2=P2^D3^D1
      S3=P3^D3^D2
      S4=P4^P3^P2^P1^D3^D2^D1
      若无错则S4 S3 S2 S1全为0
      1位错，    S4为1，其余不为000
      2位同时错, S4为0，其余不为000
    ```
- 循环冗余校验码：串行数据传输

运算结果的状态
- C：CF（进位标志）
- Z：ZF（零标志位）
- V：OF（overflow溢出标志位）
- S：SF（符号标志位）

浮点数
- 符号位
- 尾数
- 阶码（指数部分）

IEEE浮点数标准754
- 阶码使用移码， $阶码=原值+2^{n-1}-1$，阶码值全0和全1有特殊含义
- 尾数使用原码
- 32位单精度，1bit 符号, 8bit 阶码（偏置常数127）, 23bit 尾数，
- 64位双精度，1bit 符号, 11bit 阶码（偏置常数1047）, 52bit 尾数

浮点数运算：
- 加减运算5个步骤
  - 对阶，阶码小的数尾数右移阶码差值位
  - 尾数加减
  - 规格化处理
  - 舍入操作（可能在此规格化处理
  - 判断结果正确性
- 注：浮点数的加减不满足结合律，并且也不能进行相等比较

---

指令系统
- 指令使计算机运行的最小的功能单元
- 功能和分类：
  - 算术与逻辑运算指令
  - 位移操作指令
  - 数据传送指令
  - 输入输出指令
  - 转移指令
  - 子程序调用与返回指令
  - 堆栈操作指令
  - 其他指令
- 组成：操作码，地址码
- 指令字长：一条指令的二进制位数

定长操作码：操作码位数固定不变
变长操作码：一地址，二地址，三地址，多地址等

寻址方式：
- 立即数寻址：操作数在地址字段直接给出,
- 直接寻址：地址码为操作数在存储器中的地址,EA=A
- 寄存器寻址：地址码为寄存器编号（地址），寄存器中存放操作数
- 寄存器间接寻址：地址码为寄存器编号（地址），寄存器存放内存编号，内存中存放操作数
- 变址寻址：操作数地址由变址寄存器的内容和变址偏移量相加得到
- 相对寻址：由程序计数器PC内容和相对寻址偏移量相加得到，偏移量用补码表示
- 间接寻址：地址码给出操作数地址的地址
- 基址寻址：基址寄存器内容和地址码中的偏移量相加得到操作数地址
- 堆栈寻址：

指令系统的两种设计思路：
- RISC（精简指令集）：通用寄存器较多，采用组合逻辑电路控制，使用Load/Store型指令设计风格，典型的精简指令集MIPS
- CISC（复杂指令集）：通用寄存器较少，采用微程序控制，指令周期长

MIPS指令格式，均为32位宽度：
- 指令格式：
  - 寄存器型（R）：6位OP，5位rs，5位rt，5位rd，5位shamt，6位funct。操作码OP为“000000”，操作类型由funct字段指定
    - 双目运算类指令，rs和rt内容对应第一和第二源操作数，结果给rd
    - 移位指令，对rt内容移位，结果送rd，移位数由sa字段给出
    - 寻址方式只有寄存器寻址
  - 立即数型(I):6位OP，5位rs，5位rt，其余address/immediate
    - 双目运算类指令，将rs内容和立即数分别作为第一和第二源操作数，结果送rt
    - Load/Store指令，则将rs内容和立即数符号扩展后的内容相加作为存储单元地址，Load指令将内存单元内容送rt，Store将rt内容送内存单元
    - 分支指令，对rs和rt内容进行指定运算，根据运算结果，决定是否转到转移目标地址处执行，转移目标地址通过相对寻址方式得到
    - 有寄存器寻址，立即数寻址，相对寻址，基址，变址寻址
  - 转移性(J):6位OP，其余target。
    - 无条件跳转指令，指令中给出的26位是直接地址，将PC的高4位拼上26位直接地址，最后添加两个“0”（字节对齐地址必为4的倍数）`PC[31:28]||target[25:0]||[00]`即可得到32位转移目标地址
    - 只有直接寻址
- 操作数寻址方式：
  - 基址加16位位移量的访存寻址
  - 立即数寻址
  - 寄存器寻址
- 指令特点：
  - 指令长度固定32位
  - 寄存器位置固定（目的寄存器位置有所变动，但源寄存器位置固定）

指令的执行过程：
- 读取指令      取指（IF）  IM、PC、总线
- 指令译码      译码（ID）  寄存器组，控制信号生成部件
- 执行运算      执行（EX）  ALU
- 存储器读写    访存（MEM） DM(data memery)、总线
- 写回          写回（WB）  寄存器组

---

单周期CPU：全部指令都是用一个CPU周期完成，CPU周期时间固定
  - 缺点：信号竞争，地址、数据和“写使能”之间存在竞争，组成部件利用率不高

多周期CPU：
  - 将指令执行的过程分解为多个步骤，**每个步骤的时钟周期固定**
  - 有锁存器
  - 两种控制器：
    - 硬连线控制器（组合逻辑控制器）
    - 微程序控制器：采用控制存储器存储每条指令所需的控制信号
  - 部件利用率偏低
  
指令流水线CPU：
- 计算机各个部件均可使用流水线（指令流水线，操作部件流水线，宏流水线）
- 有锁存器（保存本流水段的结果）
- 每条指令5个时钟周期（指令执行过程）
- 性能指标：
  - 吞吐率：单位时间执行的指令数量
  - 加速比：与串行执行相比速度提高的比率

---

多周期CPU下MIPS指令执行步骤：
- 取指：1步
- 在取指之后
  - J型指令，`PC[31:28]`与target拼接，1步
  - 相对转移I型指令（beq），读寄存器堆，ALU运算，2步
  - R型指令，读寄存器堆，ALU运算，结果写回，3步
  - 读内存I型指令，读寄存器堆，ALU算地址，读内存数据到DR，把DR内容写入寄存器堆，4步

